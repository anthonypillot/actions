name: 🏗️ Build

on:
  workflow_call:
    inputs:
      run_test:
        type: boolean
        description: Run tests after build.
        required: false
        default: false
      run_test_command:
        type: string
        description: npm test command to run after build (e.g. 'test', 'test:unit').
        required: false
        default: "test"

permissions:
  contents: read

jobs:
  build:
    name: Build

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [lts/*, current]

    steps:
      - name: 📥 Checkout
        uses: actions/checkout@v4

      - name: 🌐 Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: npm

      - name: 📦 Install dependencies
        run: npm ci

      - name: 🏗️ Build application
        run: npm run build

      - name: 🧪 Run tests
        if: ${{ inputs.run_test }}
        run: npm run ${{ inputs.run_test_command }}
